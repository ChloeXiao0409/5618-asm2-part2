<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Catalog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.shatteredpixel.shatteredpixeldungeon.journal</a> &gt; <span class="el_source">Catalog.java</span></div><h1>Catalog.java</h1><pre class="source lang-java linenums">/*
 * Pixel Dungeon
 * Copyright (C) 2012-2015 Oleg Dolya
 *
 * Shattered Pixel Dungeon
 * Copyright (C) 2014-2024 Evan Debenham
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;
 */

package com.shatteredpixel.shatteredpixeldungeon.journal;

import com.shatteredpixel.shatteredpixeldungeon.Badges;
import com.shatteredpixel.shatteredpixeldungeon.items.Amulet;
import com.shatteredpixel.shatteredpixeldungeon.items.Ankh;
import com.shatteredpixel.shatteredpixeldungeon.items.ArcaneResin;
import com.shatteredpixel.shatteredpixeldungeon.items.BrokenSeal;
import com.shatteredpixel.shatteredpixeldungeon.items.Dewdrop;
import com.shatteredpixel.shatteredpixeldungeon.items.EnergyCrystal;
import com.shatteredpixel.shatteredpixeldungeon.items.Generator;
import com.shatteredpixel.shatteredpixeldungeon.items.Gold;
import com.shatteredpixel.shatteredpixeldungeon.items.Honeypot;
import com.shatteredpixel.shatteredpixeldungeon.items.KingsCrown;
import com.shatteredpixel.shatteredpixeldungeon.items.LiquidMetal;
import com.shatteredpixel.shatteredpixeldungeon.items.Stylus;
import com.shatteredpixel.shatteredpixeldungeon.items.TengusMask;
import com.shatteredpixel.shatteredpixeldungeon.items.Torch;
import com.shatteredpixel.shatteredpixeldungeon.items.Waterskin;
import com.shatteredpixel.shatteredpixeldungeon.items.armor.Armor;
import com.shatteredpixel.shatteredpixeldungeon.items.bags.MagicalHolster;
import com.shatteredpixel.shatteredpixeldungeon.items.bags.PotionBandolier;
import com.shatteredpixel.shatteredpixeldungeon.items.bags.ScrollHolder;
import com.shatteredpixel.shatteredpixeldungeon.items.bags.VelvetPouch;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.ArcaneBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.Bomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.Firebomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.FlashBangBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.FrostBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.HolyBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.Noisemaker;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.RegrowthBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.ShrapnelBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.SmokeBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.bombs.WoollyBomb;
import com.shatteredpixel.shatteredpixeldungeon.items.food.Berry;
import com.shatteredpixel.shatteredpixeldungeon.items.food.Blandfruit;
import com.shatteredpixel.shatteredpixeldungeon.items.food.ChargrilledMeat;
import com.shatteredpixel.shatteredpixeldungeon.items.food.Food;
import com.shatteredpixel.shatteredpixeldungeon.items.food.FrozenCarpaccio;
import com.shatteredpixel.shatteredpixeldungeon.items.food.MeatPie;
import com.shatteredpixel.shatteredpixeldungeon.items.food.MysteryMeat;
import com.shatteredpixel.shatteredpixeldungeon.items.food.Pasty;
import com.shatteredpixel.shatteredpixeldungeon.items.food.PhantomMeat;
import com.shatteredpixel.shatteredpixeldungeon.items.food.SmallRation;
import com.shatteredpixel.shatteredpixeldungeon.items.food.StewedMeat;
import com.shatteredpixel.shatteredpixeldungeon.items.food.SupplyRation;
import com.shatteredpixel.shatteredpixeldungeon.items.keys.CrystalKey;
import com.shatteredpixel.shatteredpixeldungeon.items.keys.GoldenKey;
import com.shatteredpixel.shatteredpixeldungeon.items.keys.IronKey;
import com.shatteredpixel.shatteredpixeldungeon.items.keys.SkeletonKey;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.AquaBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.BlizzardBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.CausticBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.InfernalBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.ShockingBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.brews.UnstableBrew;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfAquaticRejuvenation;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfArcaneArmor;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfDragonsBlood;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfFeatherFall;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfHoneyedHealing;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfIcyTouch;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfMight;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.elixirs.ElixirOfToxicEssence;
import com.shatteredpixel.shatteredpixeldungeon.items.potions.exotic.ExoticPotion;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.CeremonialCandle;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.CorpseDust;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.DarkGold;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.DwarfToken;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.Embers;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.GooBlob;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.MetalShard;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.BowFragment;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.BrokenHilt;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.BrokenStaff;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.CloakScrap;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.SealShard;
import com.shatteredpixel.shatteredpixeldungeon.items.remains.TornPage;
import com.shatteredpixel.shatteredpixeldungeon.items.scrolls.exotic.ExoticScroll;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.Alchemize;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.BeaconOfReturning;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.CurseInfusion;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.MagicalInfusion;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.PhaseShift;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.ReclaimTrap;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.Recycle;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.SummonElemental;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.TelekineticGrab;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.UnstableSpell;
import com.shatteredpixel.shatteredpixeldungeon.items.spells.WildEnergy;
import com.shatteredpixel.shatteredpixeldungeon.items.trinkets.TrinketCatalyst;
import com.shatteredpixel.shatteredpixeldungeon.items.weapon.SpiritBow;
import com.shatteredpixel.shatteredpixeldungeon.items.weapon.Weapon;
import com.shatteredpixel.shatteredpixeldungeon.items.weapon.missiles.darts.TippedDart;
import com.shatteredpixel.shatteredpixeldungeon.messages.Messages;
import com.watabou.utils.Bundle;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.LinkedHashMap;

//For items, but includes a few item-like effects, such as enchantments
<span class="nc" id="L125">public enum Catalog {</span>

	//EQUIPMENT
<span class="nc" id="L128">	MELEE_WEAPONS,</span>
<span class="nc" id="L129">	ARMOR,</span>
<span class="nc" id="L130">	ENCHANTMENTS,</span>
<span class="nc" id="L131">	GLYPHS,</span>
<span class="nc" id="L132">	THROWN_WEAPONS,</span>
<span class="nc" id="L133">	WANDS,</span>
<span class="nc" id="L134">	RINGS,</span>
<span class="nc" id="L135">	ARTIFACTS,</span>
<span class="nc" id="L136">	TRINKETS,</span>
<span class="nc" id="L137">	MISC_EQUIPMENT,</span>

	//CONSUMABLES
<span class="nc" id="L140">	POTIONS,</span>
<span class="nc" id="L141">	SEEDS,</span>
<span class="nc" id="L142">	SCROLLS,</span>
<span class="nc" id="L143">	STONES,</span>
<span class="nc" id="L144">	FOOD,</span>
<span class="nc" id="L145">	EXOTIC_POTIONS,</span>
<span class="nc" id="L146">	EXOTIC_SCROLLS,</span>
<span class="nc" id="L147">	BOMBS,</span>
<span class="nc" id="L148">	TIPPED_DARTS,</span>
<span class="nc" id="L149">	BREWS_ELIXIRS,</span>
<span class="nc" id="L150">	SPELLS,</span>
<span class="nc" id="L151">	MISC_CONSUMABLES;</span>

	//tracks whether an item has been collected while identified
<span class="nc" id="L154">	private final LinkedHashMap&lt;Class&lt;?&gt;, Boolean&gt; seen = new LinkedHashMap&lt;&gt;();</span>
	//tracks upgrades spent for equipment, uses for consumables
<span class="nc" id="L156">	private final LinkedHashMap&lt;Class&lt;?&gt;, Integer&gt; useCount = new LinkedHashMap&lt;&gt;();</span>
	
	public Collection&lt;Class&lt;?&gt;&gt; items(){
<span class="nc" id="L159">		return seen.keySet();</span>
	}

	//should only be used when initializing
	private void addItems( Class&lt;?&gt;... items){
<span class="nc bnc" id="L164" title="All 2 branches missed.">		for (Class&lt;?&gt; item : items){</span>
<span class="nc" id="L165">			seen.put(item, false);</span>
<span class="nc" id="L166">			useCount.put(item, 0);</span>
		}
<span class="nc" id="L168">	}</span>

	public String title(){
<span class="nc" id="L171">		return Messages.get(this, name() + &quot;.title&quot;);</span>
	}

	public int totalItems(){
<span class="nc" id="L175">		return seen.size();</span>
	}

	public int totalSeen(){
<span class="nc" id="L179">		int seenTotal = 0;</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">		for (boolean itemSeen : seen.values()){</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">			if (itemSeen) seenTotal++;</span>
<span class="nc" id="L182">		}</span>
<span class="nc" id="L183">		return seenTotal;</span>
	}

	static {

<span class="nc" id="L188">		MELEE_WEAPONS.addItems(Generator.Category.WEP_T1.classes);</span>
<span class="nc" id="L189">		MELEE_WEAPONS.addItems(Generator.Category.WEP_T2.classes);</span>
<span class="nc" id="L190">		MELEE_WEAPONS.addItems(Generator.Category.WEP_T3.classes);</span>
<span class="nc" id="L191">		MELEE_WEAPONS.addItems(Generator.Category.WEP_T4.classes);</span>
<span class="nc" id="L192">		MELEE_WEAPONS.addItems(Generator.Category.WEP_T5.classes);</span>

<span class="nc" id="L194">		ARMOR.addItems(Generator.Category.ARMOR.classes);</span>

<span class="nc" id="L196">		THROWN_WEAPONS.addItems(Generator.Category.MIS_T1.classes);</span>
<span class="nc" id="L197">		THROWN_WEAPONS.addItems(Generator.Category.MIS_T2.classes);</span>
<span class="nc" id="L198">		THROWN_WEAPONS.addItems(Generator.Category.MIS_T3.classes);</span>
<span class="nc" id="L199">		THROWN_WEAPONS.addItems(Generator.Category.MIS_T4.classes);</span>
<span class="nc" id="L200">		THROWN_WEAPONS.addItems(Generator.Category.MIS_T5.classes);</span>

<span class="nc" id="L202">		ENCHANTMENTS.addItems(Weapon.Enchantment.common);</span>
<span class="nc" id="L203">		ENCHANTMENTS.addItems(Weapon.Enchantment.uncommon);</span>
<span class="nc" id="L204">		ENCHANTMENTS.addItems(Weapon.Enchantment.rare);</span>
<span class="nc" id="L205">		ENCHANTMENTS.addItems(Weapon.Enchantment.curses);</span>

<span class="nc" id="L207">		GLYPHS.addItems(Armor.Glyph.common);</span>
<span class="nc" id="L208">		GLYPHS.addItems(Armor.Glyph.uncommon);</span>
<span class="nc" id="L209">		GLYPHS.addItems(Armor.Glyph.rare);</span>
<span class="nc" id="L210">		GLYPHS.addItems(Armor.Glyph.curses);</span>

<span class="nc" id="L212">		WANDS.addItems(Generator.Category.WAND.classes);</span>

<span class="nc" id="L214">		RINGS.addItems(Generator.Category.RING.classes);</span>

<span class="nc" id="L216">		ARTIFACTS.addItems(Generator.Category.ARTIFACT.classes);</span>

<span class="nc" id="L218">		TRINKETS.addItems(Generator.Category.TRINKET.classes);</span>

<span class="nc" id="L220">		MISC_EQUIPMENT.addItems(BrokenSeal.class, SpiritBow.class, Waterskin.class, VelvetPouch.class,</span>
				PotionBandolier.class, ScrollHolder.class, MagicalHolster.class, Amulet.class);



<span class="nc" id="L225">		POTIONS.addItems(Generator.Category.POTION.classes);</span>

<span class="nc" id="L227">		SCROLLS.addItems(Generator.Category.SCROLL.classes);</span>

<span class="nc" id="L229">		SEEDS.addItems(Generator.Category.SEED.classes);</span>

<span class="nc" id="L231">		STONES.addItems(Generator.Category.STONE.classes);</span>

<span class="nc" id="L233">		FOOD.addItems( Food.class, Pasty.class, MysteryMeat.class, ChargrilledMeat.class,</span>
				StewedMeat.class, FrozenCarpaccio.class, SmallRation.class, Berry.class,
				SupplyRation.class, Blandfruit.class, PhantomMeat.class, MeatPie.class );

<span class="nc" id="L237">		EXOTIC_POTIONS.addItems(ExoticPotion.exoToReg.keySet().toArray(new Class[0]));</span>

<span class="nc" id="L239">		EXOTIC_SCROLLS.addItems(ExoticScroll.exoToReg.keySet().toArray(new Class[0]));</span>

<span class="nc" id="L241">		BOMBS.addItems( Bomb.class, FrostBomb.class, Firebomb.class, SmokeBomb.class, RegrowthBomb.class,</span>
				WoollyBomb.class, Noisemaker.class, FlashBangBomb.class, HolyBomb.class, ArcaneBomb.class, ShrapnelBomb.class);

<span class="nc" id="L244">		TIPPED_DARTS.addItems(TippedDart.types.values().toArray(new Class[0]));</span>

<span class="nc" id="L246">		BREWS_ELIXIRS.addItems( UnstableBrew.class, InfernalBrew.class, BlizzardBrew.class,</span>
				ShockingBrew.class, CausticBrew.class, AquaBrew.class, ElixirOfHoneyedHealing.class,
				ElixirOfAquaticRejuvenation.class, ElixirOfArcaneArmor.class, ElixirOfDragonsBlood.class,
				ElixirOfIcyTouch.class, ElixirOfToxicEssence.class, ElixirOfMight.class, ElixirOfFeatherFall.class);

<span class="nc" id="L251">		SPELLS.addItems( UnstableSpell.class, WildEnergy.class, TelekineticGrab.class, PhaseShift.class,</span>
				Alchemize.class, CurseInfusion.class, MagicalInfusion.class, Recycle.class,
				ReclaimTrap.class, SummonElemental.class, BeaconOfReturning.class);

<span class="nc" id="L255">		MISC_CONSUMABLES.addItems( Gold.class, EnergyCrystal.class, Dewdrop.class,</span>
				IronKey.class, GoldenKey.class, CrystalKey.class, SkeletonKey.class,
				TrinketCatalyst.class, Stylus.class, Torch.class, Honeypot.class, Ankh.class,
				CorpseDust.class, Embers.class, CeremonialCandle.class, DarkGold.class, DwarfToken.class,
				GooBlob.class, TengusMask.class, MetalShard.class, KingsCrown.class,
				LiquidMetal.class, ArcaneResin.class,
				SealShard.class, BrokenStaff.class, CloakScrap.class, BowFragment.class, BrokenHilt.class, TornPage.class);

	}

	//old badges for pre-2.5
<span class="nc" id="L266">	public static LinkedHashMap&lt;Catalog, Badges.Badge&gt; catalogBadges = new LinkedHashMap&lt;&gt;();</span>
	static {
<span class="nc" id="L268">		catalogBadges.put(MELEE_WEAPONS, Badges.Badge.ALL_WEAPONS_IDENTIFIED);</span>
<span class="nc" id="L269">		catalogBadges.put(ARMOR, Badges.Badge.ALL_ARMOR_IDENTIFIED);</span>
<span class="nc" id="L270">		catalogBadges.put(WANDS, Badges.Badge.ALL_WANDS_IDENTIFIED);</span>
<span class="nc" id="L271">		catalogBadges.put(RINGS, Badges.Badge.ALL_RINGS_IDENTIFIED);</span>
<span class="nc" id="L272">		catalogBadges.put(ARTIFACTS, Badges.Badge.ALL_ARTIFACTS_IDENTIFIED);</span>
<span class="nc" id="L273">		catalogBadges.put(POTIONS, Badges.Badge.ALL_POTIONS_IDENTIFIED);</span>
<span class="nc" id="L274">		catalogBadges.put(SCROLLS, Badges.Badge.ALL_SCROLLS_IDENTIFIED);</span>
	}

<span class="nc" id="L277">	public static ArrayList&lt;Catalog&gt; equipmentCatalogs = new ArrayList&lt;&gt;();</span>
	static {
<span class="nc" id="L279">		equipmentCatalogs.add(MELEE_WEAPONS);</span>
<span class="nc" id="L280">		equipmentCatalogs.add(ARMOR);</span>
<span class="nc" id="L281">		equipmentCatalogs.add(ENCHANTMENTS);</span>
<span class="nc" id="L282">		equipmentCatalogs.add(GLYPHS);</span>
<span class="nc" id="L283">		equipmentCatalogs.add(THROWN_WEAPONS);</span>
<span class="nc" id="L284">		equipmentCatalogs.add(WANDS);</span>
<span class="nc" id="L285">		equipmentCatalogs.add(RINGS);</span>
<span class="nc" id="L286">		equipmentCatalogs.add(ARTIFACTS);</span>
<span class="nc" id="L287">		equipmentCatalogs.add(TRINKETS);</span>
<span class="nc" id="L288">		equipmentCatalogs.add(MISC_EQUIPMENT);</span>
	}

<span class="nc" id="L291">	public static ArrayList&lt;Catalog&gt; consumableCatalogs = new ArrayList&lt;&gt;();</span>
	static {
<span class="nc" id="L293">		consumableCatalogs.add(POTIONS);</span>
<span class="nc" id="L294">		consumableCatalogs.add(SCROLLS);</span>
<span class="nc" id="L295">		consumableCatalogs.add(SEEDS);</span>
<span class="nc" id="L296">		consumableCatalogs.add(STONES);</span>
<span class="nc" id="L297">		consumableCatalogs.add(FOOD);</span>
<span class="nc" id="L298">		consumableCatalogs.add(EXOTIC_POTIONS);</span>
<span class="nc" id="L299">		consumableCatalogs.add(EXOTIC_SCROLLS);</span>
<span class="nc" id="L300">		consumableCatalogs.add(BOMBS);</span>
<span class="nc" id="L301">		consumableCatalogs.add(TIPPED_DARTS);</span>
<span class="nc" id="L302">		consumableCatalogs.add(BREWS_ELIXIRS);</span>
<span class="nc" id="L303">		consumableCatalogs.add(SPELLS);</span>
<span class="nc" id="L304">		consumableCatalogs.add(MISC_CONSUMABLES);</span>
<span class="nc" id="L305">	}</span>
	
	public static boolean isSeen(Class&lt;?&gt; cls){
<span class="nc bnc" id="L308" title="All 2 branches missed.">		for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">			if (cat.seen.containsKey(cls)) {</span>
<span class="nc" id="L310">				return cat.seen.get(cls);</span>
			}
		}
<span class="nc" id="L313">		return false;</span>
	}
	
	public static void setSeen(Class&lt;?&gt; cls){
<span class="nc bnc" id="L317" title="All 2 branches missed.">		for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L318" title="All 4 branches missed.">			if (cat.seen.containsKey(cls) &amp;&amp; !cat.seen.get(cls)) {</span>
<span class="nc" id="L319">				cat.seen.put(cls, true);</span>
<span class="nc" id="L320">				Journal.saveNeeded = true;</span>
			}
		}
<span class="nc" id="L323">		Badges.validateCatalogBadges();</span>
<span class="nc" id="L324">	}</span>

	public static int useCount(Class&lt;?&gt; cls){
<span class="nc bnc" id="L327" title="All 2 branches missed.">		for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">			if (cat.useCount.containsKey(cls)) {</span>
<span class="nc" id="L329">				return cat.useCount.get(cls);</span>
			}
		}
<span class="nc" id="L332">		return 0;</span>
	}

	public static void countUse(Class&lt;?&gt; cls){
<span class="nc" id="L336">		countUses(cls, 1);</span>
<span class="nc" id="L337">	}</span>

	public static void countUses(Class&lt;?&gt; cls, int uses){
<span class="nc bnc" id="L340" title="All 2 branches missed.">		for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L341" title="All 4 branches missed.">			if (cat.useCount.containsKey(cls) &amp;&amp; cat.useCount.get(cls) != Integer.MAX_VALUE) {</span>
<span class="nc" id="L342">				cat.useCount.put(cls, cat.useCount.get(cls)+uses);</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">				if (cat.useCount.get(cls) &lt; -1_000_000_000){ //to catch cases of overflow</span>
<span class="nc" id="L344">					cat.useCount.put(cls, Integer.MAX_VALUE);</span>
				}
<span class="nc" id="L346">				Journal.saveNeeded = true;</span>
			}
		}
<span class="nc" id="L349">	}</span>

	private static final String CATALOG_CLASSES = &quot;catalog_classes&quot;;
	private static final String CATALOG_SEEN    = &quot;catalog_seen&quot;;
	private static final String CATALOG_USES    = &quot;catalog_uses&quot;;
	
	public static void store( Bundle bundle ){

<span class="nc" id="L357">		ArrayList&lt;Class&lt;?&gt;&gt; classes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L358">		ArrayList&lt;Boolean&gt; seen = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L359">		ArrayList&lt;Integer&gt; uses = new ArrayList&lt;&gt;();</span>
		
<span class="nc bnc" id="L361" title="All 2 branches missed.">		for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">			for (Class&lt;?&gt; item : cat.items()) {</span>
<span class="nc bnc" id="L363" title="All 4 branches missed.">				if (cat.seen.get(item) || cat.useCount.get(item) &gt; 0){</span>
<span class="nc" id="L364">					classes.add(item);</span>
<span class="nc" id="L365">					seen.add(cat.seen.get(item));</span>
<span class="nc" id="L366">					uses.add(cat.useCount.get(item));</span>
				}
<span class="nc" id="L368">			}</span>
		}

<span class="nc" id="L371">		Class&lt;?&gt;[] storeCls = new Class[classes.size()];</span>
<span class="nc" id="L372">		boolean[] storeSeen = new boolean[seen.size()];</span>
<span class="nc" id="L373">		int[] storeUses = new int[uses.size()];</span>

<span class="nc bnc" id="L375" title="All 2 branches missed.">		for (int i = 0; i &lt; storeCls.length; i++){</span>
<span class="nc" id="L376">			storeCls[i] = classes.get(i);</span>
<span class="nc" id="L377">			storeSeen[i] = seen.get(i);</span>
<span class="nc" id="L378">			storeUses[i] = uses.get(i);</span>
		}
		
<span class="nc" id="L381">		bundle.put( CATALOG_CLASSES, storeCls );</span>
<span class="nc" id="L382">		bundle.put( CATALOG_SEEN, storeSeen );</span>
<span class="nc" id="L383">		bundle.put( CATALOG_USES, storeUses );</span>
		
<span class="nc" id="L385">	}</span>

	//pre-v2.5
	private static final String CATALOG_ITEMS = &quot;catalog_items&quot;;
	
	public static void restore( Bundle bundle ){

		//old logic for pre-v2.5 catalog-specific badges
<span class="nc" id="L393">		Badges.loadGlobal();</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">		for (Catalog cat : values()){</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">			if (Badges.isUnlocked(catalogBadges.get(cat))){</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">				for (Class&lt;?&gt; item : cat.items()){</span>
<span class="nc" id="L397">					cat.seen.put(item, true);</span>
<span class="nc" id="L398">				}</span>
			}
		}
<span class="nc bnc" id="L401" title="All 2 branches missed.">		if (bundle.contains(CATALOG_ITEMS)) {</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">			for (Class&lt;?&gt; cls : Arrays.asList(bundle.getClassArray(CATALOG_ITEMS))){</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">				for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">					if (cat.seen.containsKey(cls)) {</span>
<span class="nc" id="L405">						cat.seen.put(cls, true);</span>
					}
				}
<span class="nc" id="L408">			}</span>
		}
		//end of old logic

<span class="nc bnc" id="L412" title="All 2 branches missed.">		if (bundle.contains(CATALOG_CLASSES)){</span>
<span class="nc" id="L413">			Class&lt;?&gt;[] classes = bundle.getClassArray(CATALOG_CLASSES);</span>
<span class="nc" id="L414">			boolean[] seen = bundle.getBooleanArray(CATALOG_SEEN);</span>
<span class="nc" id="L415">			int[] uses = bundle.getIntArray(CATALOG_USES);</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">			for (int i = 0; i &lt; classes.length; i++){</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">				for (Catalog cat : values()) {</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">					if (cat.seen.containsKey(classes[i])) {</span>
<span class="nc" id="L420">						cat.seen.put(classes[i], seen[i]);</span>
<span class="nc" id="L421">						cat.useCount.put(classes[i], uses[i]);</span>
					}
				}

			}
		}

<span class="nc" id="L428">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>