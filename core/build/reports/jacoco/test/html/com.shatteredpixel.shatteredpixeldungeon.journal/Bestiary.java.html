<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Bestiary.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">com.shatteredpixel.shatteredpixeldungeon.journal</a> &gt; <span class="el_source">Bestiary.java</span></div><h1>Bestiary.java</h1><pre class="source lang-java linenums">/*
 * Pixel Dungeon
 * Copyright (C) 2012-2015 Oleg Dolya
 *
 * Shattered Pixel Dungeon
 * Copyright (C) 2014-2024 Evan Debenham
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;
 */

package com.shatteredpixel.shatteredpixeldungeon.journal;

import com.shatteredpixel.shatteredpixeldungeon.Badges;
import com.shatteredpixel.shatteredpixeldungeon.actors.hero.abilities.cleric.PowerOfMany;
import com.shatteredpixel.shatteredpixeldungeon.actors.hero.abilities.huntress.SpiritHawk;
import com.shatteredpixel.shatteredpixeldungeon.actors.hero.abilities.rogue.ShadowClone;
import com.shatteredpixel.shatteredpixeldungeon.actors.hero.abilities.rogue.SmokeBomb;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Acidic;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Albino;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.ArmoredBrute;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.ArmoredStatue;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Bandit;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Bat;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Bee;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Brute;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.CausticSlime;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Crab;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.CrystalGuardian;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.CrystalMimic;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.CrystalSpire;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.CrystalWisp;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DM100;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DM200;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DM201;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DM300;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DemonSpawner;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.DwarfKing;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.EbonyMimic;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Elemental;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Eye;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.FetidRat;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Ghoul;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Gnoll;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GnollGeomancer;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GnollGuard;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GnollSapper;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GnollTrickster;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GoldenMimic;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Golem;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Goo;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.GreatCrab;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Guard;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Mimic;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Monk;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Necromancer;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.PhantomPiranha;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Piranha;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Pylon;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Rat;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.RipperDemon;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.RotHeart;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.RotLasher;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Scorpio;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Senior;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Shaman;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Skeleton;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Slime;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Snake;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.SpectralNecromancer;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Spinner;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Statue;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Succubus;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Swarm;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Tengu;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Thief;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.TormentedSpirit;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Warlock;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.Wraith;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.YogDzewa;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.YogFist;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Blacksmith;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Ghost;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Imp;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.MirrorImage;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.PrismaticImage;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.RatKing;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Sheep;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Shopkeeper;
import com.shatteredpixel.shatteredpixeldungeon.actors.mobs.npcs.Wandmaker;
import com.shatteredpixel.shatteredpixeldungeon.items.artifacts.DriedRose;
import com.shatteredpixel.shatteredpixeldungeon.items.quest.CorpseDust;
import com.shatteredpixel.shatteredpixeldungeon.items.wands.WandOfLivingEarth;
import com.shatteredpixel.shatteredpixeldungeon.items.wands.WandOfRegrowth;
import com.shatteredpixel.shatteredpixeldungeon.items.wands.WandOfWarding;
import com.shatteredpixel.shatteredpixeldungeon.levels.rooms.special.SentryRoom;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.AlarmTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.BlazingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.BurningTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.ChillingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.ConfusionTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.CorrosionTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.CursingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.DisarmingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.DisintegrationTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.DistortionTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.ExplosiveTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.FlashingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.FlockTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.FrostTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GatewayTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GeyserTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GnollRockfallTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GrimTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GrippingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.GuardianTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.OozeTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.PitfallTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.PoisonDartTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.RockfallTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.ShockingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.StormTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.SummoningTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.TeleportationTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.TenguDartTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.ToxicTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.WarpingTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.WeakeningTrap;
import com.shatteredpixel.shatteredpixeldungeon.levels.traps.WornDartTrap;
import com.shatteredpixel.shatteredpixeldungeon.messages.Messages;
import com.shatteredpixel.shatteredpixeldungeon.plants.BlandfruitBush;
import com.shatteredpixel.shatteredpixeldungeon.plants.Blindweed;
import com.shatteredpixel.shatteredpixeldungeon.plants.Earthroot;
import com.shatteredpixel.shatteredpixeldungeon.plants.Fadeleaf;
import com.shatteredpixel.shatteredpixeldungeon.plants.Firebloom;
import com.shatteredpixel.shatteredpixeldungeon.plants.Icecap;
import com.shatteredpixel.shatteredpixeldungeon.plants.Mageroyal;
import com.shatteredpixel.shatteredpixeldungeon.plants.Rotberry;
import com.shatteredpixel.shatteredpixeldungeon.plants.Sorrowmoss;
import com.shatteredpixel.shatteredpixeldungeon.plants.Starflower;
import com.shatteredpixel.shatteredpixeldungeon.plants.Stormvine;
import com.shatteredpixel.shatteredpixeldungeon.plants.Sungrass;
import com.shatteredpixel.shatteredpixeldungeon.plants.Swiftthistle;
import com.watabou.utils.Bundle;

import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.LinkedHashMap;

//contains all the game's various entities, mostly enemies, NPCS, and allies, but also traps and plants
<span class="nc" id="L162">public enum Bestiary {</span>

<span class="nc" id="L164">	REGIONAL,</span>
<span class="nc" id="L165">	BOSSES,</span>
<span class="nc" id="L166">	UNIVERSAL,</span>
<span class="nc" id="L167">	RARE,</span>
<span class="nc" id="L168">	QUEST,</span>
<span class="nc" id="L169">	NEUTRAL,</span>
<span class="nc" id="L170">	ALLY,</span>
<span class="nc" id="L171">	TRAP,</span>
<span class="nc" id="L172">	PLANT;</span>

	//tracks whether an entity has been encountered
<span class="nc" id="L175">	private final LinkedHashMap&lt;Class&lt;?&gt;, Boolean&gt; seen = new LinkedHashMap&lt;&gt;();</span>
	//tracks enemy kills, trap activations, plant tramples, or just sets to 1 for seen on allies
<span class="nc" id="L177">	private final LinkedHashMap&lt;Class&lt;?&gt;, Integer&gt; encounterCount = new LinkedHashMap&lt;&gt;();</span>

	//should only be used when initializing
	private void addEntities(Class&lt;?&gt;... classes ){
<span class="nc bnc" id="L181" title="All 2 branches missed.">		for (Class&lt;?&gt; cls : classes){</span>
<span class="nc" id="L182">			seen.put(cls, false);</span>
<span class="nc" id="L183">			encounterCount.put(cls, 0);</span>
		}
<span class="nc" id="L185">	}</span>

	public Collection&lt;Class&lt;?&gt;&gt; entities(){
<span class="nc" id="L188">		return seen.keySet();</span>
	}

	public String title(){
<span class="nc" id="L192">		return Messages.get(this, name() + &quot;.title&quot;);</span>
	}

	public int totalEntities(){
<span class="nc" id="L196">		return seen.size();</span>
	}

	public int totalSeen(){
<span class="nc" id="L200">		int seenTotal = 0;</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">		for (boolean entitySeen : seen.values()){</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">			if (entitySeen) seenTotal++;</span>
<span class="nc" id="L203">		}</span>
<span class="nc" id="L204">		return seenTotal;</span>
	}

	static {

<span class="nc" id="L209">		REGIONAL.addEntities(Rat.class, Snake.class, Gnoll.class, Swarm.class, Crab.class, Slime.class,</span>
				Skeleton.class, Thief.class, DM100.class, Guard.class, Necromancer.class,
				Bat.class, Brute.class, Shaman.RedShaman.class, Shaman.BlueShaman.class, Shaman.PurpleShaman.class, Spinner.class, DM200.class,
				Ghoul.class, Elemental.FireElemental.class, Elemental.FrostElemental.class, Elemental.ShockElemental.class, Warlock.class, Monk.class, Golem.class,
				RipperDemon.class, DemonSpawner.class, Succubus.class, Eye.class, Scorpio.class);

<span class="nc" id="L215">		BOSSES.addEntities(Goo.class,</span>
				Tengu.class,
				Pylon.class, DM300.class,
				DwarfKing.class,
				YogDzewa.Larva.class, YogFist.BurningFist.class, YogFist.SoiledFist.class, YogFist.RottingFist.class, YogFist.RustedFist.class,YogFist.BrightFist.class, YogFist.DarkFist.class, YogDzewa.class);

<span class="nc" id="L221">		UNIVERSAL.addEntities(Wraith.class, Piranha.class, Mimic.class, GoldenMimic.class, EbonyMimic.class, Statue.class, GuardianTrap.Guardian.class, SentryRoom.Sentry.class);</span>

<span class="nc" id="L223">		RARE.addEntities(Albino.class, CausticSlime.class,</span>
				Bandit.class, SpectralNecromancer.class,
				ArmoredBrute.class, DM201.class,
				Elemental.ChaosElemental.class, Senior.class,
				Acidic.class,
				TormentedSpirit.class, PhantomPiranha.class, CrystalMimic.class, ArmoredStatue.class);

<span class="nc" id="L230">		QUEST.addEntities(FetidRat.class, GnollTrickster.class, GreatCrab.class,</span>
				Elemental.NewbornFireElemental.class, RotLasher.class, RotHeart.class,
				CrystalWisp.class, CrystalGuardian.class, CrystalSpire.class, GnollGuard.class, GnollSapper.class, GnollGeomancer.class);

<span class="nc" id="L234">		NEUTRAL.addEntities(Ghost.class, RatKing.class, Shopkeeper.class, Wandmaker.class, Blacksmith.class, Imp.class, Sheep.class, Bee.class);</span>

<span class="nc" id="L236">		ALLY.addEntities(MirrorImage.class, PrismaticImage.class,</span>
				DriedRose.GhostHero.class,
				WandOfWarding.Ward.class, WandOfWarding.Ward.WardSentry.class, WandOfLivingEarth.EarthGuardian.class,
				ShadowClone.ShadowAlly.class, SmokeBomb.NinjaLog.class, SpiritHawk.HawkAlly.class, PowerOfMany.LightAlly.class);

<span class="nc" id="L241">		TRAP.addEntities(WornDartTrap.class, PoisonDartTrap.class, DisintegrationTrap.class, GatewayTrap.class,</span>
				ChillingTrap.class, BurningTrap.class, ShockingTrap.class, AlarmTrap.class, GrippingTrap.class, TeleportationTrap.class, OozeTrap.class,
				FrostTrap.class, BlazingTrap.class, StormTrap.class, GuardianTrap.class, FlashingTrap.class, WarpingTrap.class,
				ConfusionTrap.class, ToxicTrap.class, CorrosionTrap.class,
				FlockTrap.class, SummoningTrap.class, WeakeningTrap.class, CursingTrap.class,
				GeyserTrap.class, ExplosiveTrap.class, RockfallTrap.class, PitfallTrap.class,
				DistortionTrap.class, DisarmingTrap.class, GrimTrap.class);

<span class="nc" id="L249">		PLANT.addEntities(Rotberry.class, Sungrass.class, Fadeleaf.class, Icecap.class,</span>
				Firebloom.class, Sorrowmoss.class, Swiftthistle.class, Blindweed.class,
				Stormvine.class, Earthroot.class, Mageroyal.class, Starflower.class,
				BlandfruitBush.class,
				WandOfRegrowth.Dewcatcher.class, WandOfRegrowth.Seedpod.class, WandOfRegrowth.Lotus.class);

	}

	//some mobs and traps have different internal classes in some cases, so need to convert here
<span class="nc" id="L258">	private static final HashMap&lt;Class&lt;?&gt;, Class&lt;?&gt;&gt; classConversions = new HashMap&lt;&gt;();</span>
	static {
<span class="nc" id="L260">		classConversions.put(CorpseDust.DustWraith.class,      Wraith.class);</span>

<span class="nc" id="L262">		classConversions.put(Necromancer.NecroSkeleton.class,  Skeleton.class);</span>

<span class="nc" id="L264">		classConversions.put(TenguDartTrap.class,              PoisonDartTrap.class);</span>
<span class="nc" id="L265">		classConversions.put(GnollRockfallTrap.class,          RockfallTrap.class);</span>

<span class="nc" id="L267">		classConversions.put(DwarfKing.DKGhoul.class,          Ghoul.class);</span>
<span class="nc" id="L268">		classConversions.put(DwarfKing.DKWarlock.class,        Warlock.class);</span>
<span class="nc" id="L269">		classConversions.put(DwarfKing.DKMonk.class,           Monk.class);</span>
<span class="nc" id="L270">		classConversions.put(DwarfKing.DKGolem.class,          Golem.class);</span>

<span class="nc" id="L272">		classConversions.put(YogDzewa.YogRipper.class,         RipperDemon.class);</span>
<span class="nc" id="L273">		classConversions.put(YogDzewa.YogEye.class,            Eye.class);</span>
<span class="nc" id="L274">		classConversions.put(YogDzewa.YogScorpio.class,        Scorpio.class);</span>
	}

	public static boolean isSeen(Class&lt;?&gt; cls){
<span class="nc bnc" id="L278" title="All 2 branches missed.">		for (Bestiary cat : values()) {</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">			if (cat.seen.containsKey(cls)) {</span>
<span class="nc" id="L280">				return cat.seen.get(cls);</span>
			}
		}
<span class="nc" id="L283">		return false;</span>
	}

	public static void setSeen(Class&lt;?&gt; cls){
<span class="nc bnc" id="L287" title="All 2 branches missed.">		if (classConversions.containsKey(cls)){</span>
<span class="nc" id="L288">			cls = classConversions.get(cls);</span>
		}
<span class="nc bnc" id="L290" title="All 2 branches missed.">		for (Bestiary cat : values()) {</span>
<span class="nc bnc" id="L291" title="All 4 branches missed.">			if (cat.seen.containsKey(cls) &amp;&amp; !cat.seen.get(cls)) {</span>
<span class="nc" id="L292">				cat.seen.put(cls, true);</span>
<span class="nc" id="L293">				Journal.saveNeeded = true;</span>
			}
		}
<span class="nc" id="L296">		Badges.validateCatalogBadges();</span>
<span class="nc" id="L297">	}</span>

	public static int encounterCount(Class&lt;?&gt; cls) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">		for (Bestiary cat : values()) {</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">			if (cat.encounterCount.containsKey(cls)) {</span>
<span class="nc" id="L302">				return cat.encounterCount.get(cls);</span>
			}
		}
<span class="nc" id="L305">		return 0;</span>
	}

	//used primarily when bosses are killed and need to clean up their minions
<span class="nc" id="L309">	public static boolean skipCountingEncounters = false;</span>

	public static void countEncounter(Class&lt;?&gt; cls){
<span class="nc" id="L312">		countEncounters(cls, 1);</span>
<span class="nc" id="L313">	}</span>

	public static void countEncounters(Class&lt;?&gt; cls, int encounters){
<span class="nc bnc" id="L316" title="All 2 branches missed.">		if (skipCountingEncounters){</span>
<span class="nc" id="L317">			return;</span>
		}
<span class="nc bnc" id="L319" title="All 2 branches missed.">		if (classConversions.containsKey(cls)){</span>
<span class="nc" id="L320">			cls = classConversions.get(cls);</span>
		}
<span class="nc bnc" id="L322" title="All 2 branches missed.">		for (Bestiary cat : values()) {</span>
<span class="nc bnc" id="L323" title="All 4 branches missed.">			if (cat.encounterCount.containsKey(cls) &amp;&amp; cat.encounterCount.get(cls) != Integer.MAX_VALUE){</span>
<span class="nc" id="L324">				cat.encounterCount.put(cls, cat.encounterCount.get(cls)+encounters);</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">				if (cat.encounterCount.get(cls) &lt; -1_000_000_000){ //to catch cases of overflow</span>
<span class="nc" id="L326">					cat.encounterCount.put(cls, Integer.MAX_VALUE);</span>
				}
<span class="nc" id="L328">				Journal.saveNeeded = true;</span>
			}
		}
<span class="nc" id="L331">	}</span>

	private static final String BESTIARY_CLASSES    = &quot;bestiary_classes&quot;;
	private static final String BESTIARY_SEEN       = &quot;bestiary_seen&quot;;
	private static final String BESTIARY_ENCOUNTERS = &quot;bestiary_encounters&quot;;

	public static void store( Bundle bundle ){

<span class="nc" id="L339">		ArrayList&lt;Class&lt;?&gt;&gt; classes = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L340">		ArrayList&lt;Boolean&gt; seen = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L341">		ArrayList&lt;Integer&gt; encounters = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L343" title="All 2 branches missed.">		for (Bestiary cat : values()) {</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">			for (Class&lt;?&gt; entity : cat.entities()) {</span>
<span class="nc bnc" id="L345" title="All 4 branches missed.">				if (cat.seen.get(entity) || cat.encounterCount.get(entity) &gt; 0){</span>
<span class="nc" id="L346">					classes.add(entity);</span>
<span class="nc" id="L347">					seen.add(cat.seen.get(entity));</span>
<span class="nc" id="L348">					encounters.add(cat.encounterCount.get(entity));</span>
				}
<span class="nc" id="L350">			}</span>
		}

<span class="nc" id="L353">		Class&lt;?&gt;[] storeCls = new Class[classes.size()];</span>
<span class="nc" id="L354">		boolean[] storeSeen = new boolean[seen.size()];</span>
<span class="nc" id="L355">		int[] storeEncounters = new int[encounters.size()];</span>

<span class="nc bnc" id="L357" title="All 2 branches missed.">		for (int i = 0; i &lt; storeCls.length; i++){</span>
<span class="nc" id="L358">			storeCls[i] = classes.get(i);</span>
<span class="nc" id="L359">			storeSeen[i] = seen.get(i);</span>
<span class="nc" id="L360">			storeEncounters[i] = encounters.get(i);</span>
		}

<span class="nc" id="L363">		bundle.put( BESTIARY_CLASSES, storeCls );</span>
<span class="nc" id="L364">		bundle.put( BESTIARY_SEEN, storeSeen );</span>
<span class="nc" id="L365">		bundle.put( BESTIARY_ENCOUNTERS, storeEncounters );</span>

<span class="nc" id="L367">	}</span>

	public static void restore( Bundle bundle ){

<span class="nc bnc" id="L371" title="All 2 branches missed.">		if (bundle.contains(BESTIARY_CLASSES)</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">				&amp;&amp; bundle.contains(BESTIARY_SEEN)</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">				&amp;&amp; bundle.contains(BESTIARY_ENCOUNTERS)){</span>
<span class="nc" id="L374">			Class&lt;?&gt;[] classes = bundle.getClassArray(BESTIARY_CLASSES);</span>
<span class="nc" id="L375">			boolean[] seen = bundle.getBooleanArray(BESTIARY_SEEN);</span>
<span class="nc" id="L376">			int[] encounters = bundle.getIntArray(BESTIARY_ENCOUNTERS);</span>

<span class="nc bnc" id="L378" title="All 2 branches missed.">			for (int i = 0; i &lt; classes.length; i++){</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">				for (Bestiary cat : values()){</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">					if (cat.seen.containsKey(classes[i])){</span>
<span class="nc" id="L381">						cat.seen.put(classes[i], seen[i]);</span>
<span class="nc" id="L382">						cat.encounterCount.put(classes[i], encounters[i]);</span>
					}
				}
			}
		}

<span class="nc" id="L388">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>